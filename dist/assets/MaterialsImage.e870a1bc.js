import{u as P}from"./ali-oss.382a9c69.js";import{d as U,cp as O,aC as B,w as c,ae as q,k as M,r as f,o as w,n as j,p as r,J as _,N as R}from"./index.f012a3f4.js";import{P as L}from"./PlusOutlined.0c40939d.js";import{U as k}from"./index.3a3a0b83.js";import"./vendor.352e3120.js";import"./upload.f886bf9f.js";import"./uniqBy.1b31fa16.js";import"./_baseIteratee.c907cd0a.js";import"./get.4bb36d6d.js";import"./hasIn.e5f45297.js";import"./_baseProperty.74f89655.js";import"./findIndex.2bc5b0a2.js";import"./toInteger.87149fb4.js";import"./index.ccba4a8f.js";import"./FileOutlined.dfec8941.js";import"./DeleteOutlined.4af221e4.js";function x(a){return new Promise((o,l)=>{const s=new FileReader;s.readAsDataURL(a),s.onload=()=>o(s.result),s.onerror=t=>l(t)})}var I=U({components:{PlusOutlined:L,Upload:k,Modal:O},name:"MaterialsImage",props:{max:B.number,materialsBaseInfo:Object},emits:["uploadSuccess"],setup(a,{emit:o}){const l=c(!1),s=c(""),t=c([]);q(a,(e,i)=>{if(a.materialsBaseInfo&&a.materialsBaseInfo.imgUrl){let n=0;t.value=a.materialsBaseInfo.imgUrl.trim().split(",").map(p=>(n--,{uid:n,name:n+".png",status:"done",url:p}))}});let d=M(()=>{if(t.value&&t.value.length>0)return t.value.filter(e=>e.url).map(e=>e.url).join(",")});return{previewVisible:l,previewImage:s,fileList:t,handleCancel:()=>{l.value=!1},handlePreview:async e=>{!e.url&&!e.preview&&(e.preview=await x(e.originFileObj)),s.value=e.url||e.preview,l.value=!0},handleChange:e=>{e.file.status==="uploading"},customRequest:e=>{const i=e.file;let n=i.name,p=n.lastIndexOf("."),C=n.substr(p),y=`${Date.parse(new Date)}`+parseInt(Math.random()*1e4)+C;P(y,i).then(m=>{let u=m.res.requestUrls[0];u.indexOf("uploadId=")>0&&(u=u.split("?uploadId=")[0]),t.value[t.value.length-1]={uid:"-"+t.value.length+1,name:t.value.length+1+".png",status:"done",url:u},o("uploadSuccess",d)}).catch(m=>{console.log(m),i.status="failed"})},beforeUpload:e=>{console.log(e);const i=e.type==="image/jpeg"||e.type==="image/png",n=e.size/1024/1024<10;return i&&n},result:d}}}),te="";const $={class:"clearfix"},D={key:0},N=r("div",{class:"ant-upload-text"},"\u4E0A\u4F20",-1);function V(a,o,l,s,t,d){const v=f("plus-outlined"),g=f("Upload"),h=f("Modal");return w(),j("div",$,[r(g,{"file-list":a.fileList,"onUpdate:file-list":o[1]||(o[1]=b=>a.fileList=b),customRequest:a.customRequest,onChange:a.handleChange,"list-type":"picture-card",class:"sku-uploade",onPreview:a.handlePreview},{default:_(()=>[a.fileList.length<a.max?(w(),j("div",D,[r(v),N])):R("",!0)]),_:1},8,["file-list","customRequest","onChange","onPreview"]),r(h,{visible:a.previewVisible,footer:null,onCancel:a.handleCancel},{default:_(()=>[r("img",{alt:"example",style:{width:"100%"},src:a.previewImage},null,8,["src"])]),_:1},8,["visible","onCancel"])])}I.render=V;export default I;

import{_ as _sfc_main$3}from"./index.vue_vue&type=script&lang.af4d6d2d.js";import{b as bySkuId}from"./sku.ec13f28f.js";import{s as simpleList}from"./warehouse.d5f3b17e.js";import{l as listBySkyId}from"./buyTaskItem.14a55e70.js";import{c as create,a as customCreateBuyOrder}from"./buyOrder.9e5ec1f4.js";import{_ as _sfc_main$2}from"./PageWrapper.69acb2a5.js";import{j as useI18n,h as hooks,d as defineComponent,B as Button,cM as Empty,d8 as ExclamationCircleOutlined,b7 as Spin,v as Input,cp as Modal,bG as api,bH as useRouter,k as computed,D as unref,w as ref,x as onMounted,p as createVNode,aW as pushScopeId,aX as popScopeId,r as resolveComponent,o as openBlock,n as createBlock,q as toDisplayString,N as createCommentVNode,aF as withScopeId,L as createTextVNode}from"./index.b6dfbfcf.js";import{_ as _sfc_main$1}from"./TableImg.62dc4313.js";import"./BasicForm.ba267815.js";import{u as useTable}from"./useTable.f7c905cd.js";import{D as Divider}from"./index.57ea38db.js";import{T as Tag}from"./index.e5a6a79c.js";import{B as Badge}from"./index.389277cd.js";import{S as SettingOutlined}from"./SettingOutlined.31bf1a90.js";import{C as Card}from"./index.4d2d1116.js";import{S as Statistic}from"./index.19b0dc2f.js";import{R as Row,C as Col}from"./index.fc5361f4.js";import{F as Form,a as FormItem}from"./index.f73b7b74.js";import{I as InputNumber}from"./index.9816e582.js";import"./index.71e163ff.js";import"./responsiveObserve.7206f913.js";import"./get.4daef9c8.js";import"./commonEnum.da040d67.js";import"./usePageContext.4aadab4f.js";import"./onMountedOrActivated.9d53918d.js";import"./index.a846e3a0.js";import"./index.4cbf17ba.js";import"./useBreakpoint.4a44e358.js";import"./useSize.fb5b95d6.js";import"./transButton.bd1bd746.js";import"./ArrowLeftOutlined.7dae0225.js";import"./vendor.352e3120.js";import"./useForm.93cfb83b.js";import"./index.238a8995.js";import"./index.f208c793.js";import"./uuid.2b29000c.js";import"./useWindowSizeFn.fee40caf.js";import"./useModal.2752a197.js";import"./FullscreenOutlined.fdd43b18.js";import"./useSortable.f59e44e0.js";import"./RedoOutlined.6634afa6.js";import"./useFullScreen.67aa57a8.js";import"./index.0c19262d.js";import"./css.b1edd3c8.js";import"./canUseDom.0bf35682.js";import"./useState.9c0f957d.js";import"./conductUtil.8c9b1169.js";import"./index.658efdb1.js";import"./scrollTo.c0c7cc64.js";import"./useExpose.6218ae5d.js";import"./index.ffba0b1a.js";import"./useFormItem.23c9ece5.js";import"./iconUtil.018c1850.js";import"./_baseSet.e7326e09.js";import"./hasIn.babd797c.js";import"./FileOutlined.44378449.js";import"./user.45434715.js";import"./DeleteOutlined.e9575d1c.js";import"./index.1aad4d44.js";import"./index.672abebf.js";import"./uniqBy.c4f2e7ec.js";import"./_baseIteratee.2e9463e3.js";import"./_baseProperty.74f89655.js";import"./findIndex.c7191173.js";import"./toInteger.e4331dbc.js";import"./index.68ce2096.js";import"./download.d97e990c.js";import"./index.03ecce9c.js";import"./dayjs.c72a52f8.js";import"./isNumeric.2bec345d.js";import"./index.d98a3c80.js";import"./UpOutlined.4269b743.js";import"./PlusOutlined.84d8b58b.js";import"./Col.590da3fb.js";const{t}=useI18n(),columns=[{title:t("lamp.materials.buyTaskItem.warehouseId"),dataIndex:"warehouseId"},{title:t("lamp.materials.buyTaskItem.status"),dataIndex:"status"},{title:"\u53D1\u8D77\u4EBA",dataIndex:"createUser",width:200},{title:t("lamp.materials.buyTaskItem.requireTime"),dataIndex:"requireTime"},{title:t("lamp.materials.buyTaskItem.quantity"),dataIndex:"quantity"},{title:t("lamp.materials.buyTaskItem.optionName"),dataIndex:"optionName"},{title:t("lamp.common.createTime"),dataIndex:"createTime",width:180}];t("lamp.common.createTime"),t("lamp.materials.buyTaskItem.warehouseInventoryRecordId"),t("lamp.materials.buyTaskItem.warehouseId"),t("lamp.materials.buyTaskItem.status"),t("lamp.materials.buyTaskItem.materialsId"),t("lamp.materials.buyTaskItem.skuId"),t("lamp.materials.buyTaskItem.requireTime"),hooks("00:00:00","HH:mm:ss"),t("lamp.materials.buyTaskItem.quantity"),t("lamp.materials.buyTaskItem.optionName");var _sfc_main=defineComponent({name:"taskItemDeList",components:{BasicTable:_sfc_main$1,PageWrapper:_sfc_main$2,[Divider.name]:Divider,Tag,Badge,Button,SettingOutlined,Card,Description:_sfc_main$3,Statistic,Row,Col,Empty,ExclamationCircleOutlined,Spin,Form,FormItem,Input,InputNumber,Modal,message:api},setup(){const{currentRoute}=useRouter(),params=computed(()=>unref(currentRoute).params),sum=ref(0),sku=ref(),skuName=ref(),buyTaskList=ref(),formRef=ref(),btnLoading=ref(!1),cusTomBtnLoading=ref(!1),visible=ref(!1),spinning=ref(!1),buyOrder=ref({}),rules={quantity:[{required:!0,message:"\u91C7\u8D2D\u6570\u91CF\u4E0D\u80FD\u4E3A\u7A7A"}],remark:[{required:!0,message:"\u5907\u6CE8\u4E0D\u80FD\u4E3A\u7A7A"}]},warehouseMap=ref(new Map);onMounted(()=>{simpleList().then(e=>e.forEach(a=>warehouseMap.value.set(a.id,a.name))),getInfo(),getTaskItemList()});function getTaskItemList(){listBySkyId(params.value.id).then(res=>{buyTaskList.value=res,sum.value=eval(buyTaskList.value.map(e=>e.quantity).join("+"))||0})}const{t}=useI18n(),[registerTable,{reload,getSelectRowKeys}]=useTable({title:"\u5F85\u5904\u7406\u91C7\u8D2D\u4EFB\u52A1\u5217\u8868",dataSource:buyTaskList,pagination:!1,columns,formConfig:{labelWidth:120},useSearchForm:!1,showTableSetting:!1,bordered:!0,rowKey:"id",rowSelection:{type:"checkbox"}});function getInfo(){bySkuId(params.value.id).then(e=>{skuName.value=e.skuName,sku.value=e.sku,new Map(Object.entries(skuName.value)).forEach((a,u)=>{sku.value.skuSchema?sku.value.skuSchema+=" "+a:sku.value.skuSchema=a}),sku.value.materialsSku=e.materialsBaseInfo.name+"-"+sku.value.skuSchema})}function createBuyOrder(){Modal.confirm({title:"\u786E\u5B9A\u53D1\u8D77\u91C7\u8D2D\u8BA2\u5355?",cancelText:"\u53D6\u6D88",okText:"\u786E\u8BA4",icon:createVNode(ExclamationCircleOutlined),content:createVNode("div",{style:"color:red;"},"\u91C7\u8D2D\u6570\u91CF\uFF1A"+sum.value),onOk(){btnLoading.value=!0,create(params.value.id).then(e=>{api.success("\u8BA2\u5355\u521B\u5EFA\u6210\u529F")}).finally(()=>{btnLoading.value=!1})},onCancel(){console.log("Cancel")},class:"test"})}function customCreateBuyOrder$1(){buyOrder.value={quantity:sum.value,remark:""},visible.value=!0}function commitBuyOrder(){formRef.value.validate().then(()=>{spinning.value=!0,cusTomBtnLoading.value=!0;let e={skuId:params.value.id,quantity:buyOrder.value.quantity,remark:buyOrder.value.remark};customCreateBuyOrder(e).then(a=>{spinning.value=!1,visible.value=!1,getTaskItemList(),api.success("\u8BA2\u5355\u521B\u5EFA\u6210\u529F")}).finally(()=>{spinning.value=!1,cusTomBtnLoading.value=!1})}).catch(e=>{console.log("error",e)})}const skuSchema=[{label:"\u7269\u6599-\u89C4\u683C",field:"materialsSku"},{label:"\u5355\u4F4D",field:"unit"},{label:"\u7269\u6599\u7F16\u7801",field:"code"},{label:"\u5BA1\u6279\u7C7B\u578B",field:"auditType"},{label:"\u5B89\u5168\u5E93\u5B58",field:"minQuantity"},{label:"\u91C7\u8D2D\u6307\u5BFC\u5355\u4EF7",field:"price"},{label:"\u9886\u7528\u5355\u4EF7",field:"claimPrice"},{label:"\u5907\u6CE8",field:"remark"}],colorList=["green","cyan","#2db7f5","purple"];return{t,params,sku,skuName,warehouseMap,registerTable,colorList,skuSchema,columns,getInfo,sum,createBuyOrder,visible,spinning,buyOrder,rules,formRef,commitBuyOrder,customCreateBuyOrder:customCreateBuyOrder$1,getTaskItemList,btnLoading,cusTomBtnLoading}}}),buyTaskItemList_vue_vue_type_style_index_0_scoped_true_lang=`.desc-wrap[data-v-ba334af0] {
  padding: 16px;
}`;const _withId=withScopeId();pushScopeId("data-v-ba334af0");const _hoisted_1=createTextVNode("\u6309\u4EFB\u52A1\u53D1\u8D77\u91C7\u8D2D\u8BA2\u5355"),_hoisted_2={key:0},_hoisted_3={key:1},_hoisted_4=createTextVNode("\u81EA\u5B9A\u4E49\u6570\u91CF\u53D1\u8D77\u91C7\u8D2D\u8BA2\u5355"),_hoisted_5={style:{padding:"30px",width:"100%"}};popScopeId();const _sfc_render=_withId((e,a,u,j,h,C)=>{const l=resolveComponent("Description"),r=resolveComponent("Col"),m=resolveComponent("Statistic"),d=resolveComponent("Card"),p=resolveComponent("Row"),c=resolveComponent("a-divider"),f=resolveComponent("a-button"),b=resolveComponent("BasicTable"),I=resolveComponent("Button"),_=resolveComponent("PageWrapper"),i=resolveComponent("InputNumber"),s=resolveComponent("FormItem"),v=resolveComponent("Input"),y=resolveComponent("Form"),k=resolveComponent("Spin"),g=resolveComponent("Modal");return openBlock(),createBlock("div",null,[createVNode(_,{title:"\u91C7\u8D2D\u4EFB\u52A1\u8BE6\u60C5\u5217\u8868\u9875",contentBackground:""},{rightFooter:_withId(()=>[createVNode(I,{type:"primary",danger:"",onClick:e.customCreateBuyOrder,loading:e.cusTomBtnLoading},{default:_withId(()=>[_hoisted_4]),_:1},8,["onClick","loading"])]),default:_withId(()=>[createVNode(p,null,{default:_withId(()=>[createVNode(r,{span:21},{default:_withId(()=>[createVNode(l,{size:"middle",layout:"vertical",title:"\u89C4\u683C\u4FE1\u606F",bordered:!0,column:9,data:e.sku,schema:e.skuSchema},null,8,["data","schema"])]),_:1}),createVNode(r,{span:3},{default:_withId(()=>[createVNode(d,{style:{margin:"40px 10px 0px 0px"}},{default:_withId(()=>[createVNode(m,{title:"\u5F85\u91C7\u8D2D\u6570\u91CF",value:e.sum,precision:1,"value-style":{color:"#cf1322"},style:{"margin-right":"50px"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),createVNode(c),createVNode(b,{onRegister:e.registerTable},{toolbar:_withId(()=>[createVNode(f,{danger:"",onClick:e.createBuyOrder,loading:e.btnLoading},{default:_withId(()=>[_hoisted_1]),_:1},8,["onClick","loading"])]),bodyCell:_withId(({column:o,record:n,index:B})=>[o.key==="warehouseId"?(openBlock(),createBlock("span",_hoisted_2,toDisplayString(e.warehouseMap.get(n.warehouseId)),1)):createCommentVNode("",!0),o.key==="createUser"?(openBlock(),createBlock("span",_hoisted_3,toDisplayString(n.createUserName)+"-"+toDisplayString(n.createUserPhone),1)):createCommentVNode("",!0)]),_:1},8,["onRegister"])]),_:1}),createVNode(g,{visible:e.visible,"onUpdate:visible":a[4]||(a[4]=o=>e.visible=o),title:"\u81EA\u5B9A\u4E49\u6570\u91CF\u53D1\u8D77\u91C7\u8D2D\u8BA2\u5355",onOk:e.commitBuyOrder,"confirm-loading":e.spinning},{default:_withId(()=>[createVNode(k,{spinning:e.spinning},{default:_withId(()=>[createVNode("div",_hoisted_5,[createVNode(y,{model:e.buyOrder,"label-col":{span:8},"wrapper-col":{span:14},rules:e.rules,ref:"formRef"},{default:_withId(()=>[createVNode(s,{label:"\u5F85\u529E\u4EFB\u52A1\u6570\u91CF",name:"sum"},{default:_withId(()=>[createVNode(i,{value:e.sum,"onUpdate:value":a[1]||(a[1]=o=>e.sum=o),min:0,step:1,disabled:""},null,8,["value","step"])]),_:1}),createVNode(s,{label:"\u91C7\u8D2D\u8BA2\u5355\u6570\u91CF",name:"quantity"},{default:_withId(()=>[createVNode(i,{value:e.buyOrder.quantity,"onUpdate:value":a[2]||(a[2]=o=>e.buyOrder.quantity=o),min:e.sum,step:1},null,8,["value","min","step"])]),_:1}),createVNode(s,{label:"\u8BA2\u5355\u8BF4\u660E",name:"remark"},{default:_withId(()=>[createVNode(v,{value:e.buyOrder.remark,"onUpdate:value":a[3]||(a[3]=o=>e.buyOrder.remark=o)},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["spinning"])]),_:1},8,["visible","onOk","confirm-loading"])])});_sfc_main.render=_sfc_render,_sfc_main.__scopeId="data-v-ba334af0";export default _sfc_main;

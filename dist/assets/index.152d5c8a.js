import{_ as _sfc_main$1}from"./index.vue_vue&type=script&lang.6a8b54e5.js";import{_ as _sfc_main$2}from"./TableImg.10c90ed7.js";import"./BasicForm.8a90524a.js";import{u as useTable}from"./useTable.718a222d.js";import{_ as _sfc_main$3}from"./PageWrapper.62f72559.js";import{b as bySkuId}from"./sku.b44d5bf6.js";import{s as simpleList}from"./warehouse.41df4108.js";import{l as listBySkuId,c as changeQuantity}from"./warehouseInventory.2d507791.js";import{l as listBySkuId$1}from"./warehouseInventoryRecord.f54fd6b6.js";import{refundTimeTableSchema,refundTimeTableData,skuCommonColumns}from"./data.4689ba17.js";import{d as defineComponent,B as Button,cp as Modal,v as Input,cM as Empty,b7 as Spin,bH as useRouter,k as computed,D as unref,w as ref,x as onMounted,aW as pushScopeId,aX as popScopeId,r as resolveComponent,o as openBlock,n as createBlock,p as createVNode,N as createCommentVNode,M as Fragment,aE as renderList,aD as createSlots,L as createTextVNode,q as toDisplayString,aF as withScopeId}from"./index.b7a14d4f.js";import{D as Divider}from"./index.f8f362f5.js";import{T as Tag}from"./index.82115275.js";import{B as Badge}from"./index.b685f742.js";import{I as InputNumber}from"./index.bf350d2a.js";import{S as SettingOutlined}from"./SettingOutlined.522a0031.js";import{F as Form,a as FormItem}from"./index.b5e3a742.js";import{T as Timeline,a as TimelineItem,R as RightCircleFilled,L as LeftCircleFilled}from"./RightCircleFilled.4b09dcd6.js";import{C as Card}from"./index.37305df8.js";import{D as Descriptions,a as DescriptionsItem}from"./index.d5da9a94.js";import"./get.17b5f080.js";import"./useForm.1103fde3.js";import"./index.4c37e48f.js";import"./index.18e73f7c.js";import"./uuid.2b29000c.js";import"./useWindowSizeFn.1c78bb1f.js";import"./useModal.cb74101d.js";import"./FullscreenOutlined.c2c9b8db.js";import"./onMountedOrActivated.64fcf717.js";import"./useSortable.f7e6c10b.js";import"./RedoOutlined.2970476a.js";import"./useFullScreen.d88d5206.js";import"./index.cb0a297c.js";import"./css.b1edd3c8.js";import"./canUseDom.0bf35682.js";import"./useState.9469ce58.js";import"./conductUtil.b952d6da.js";import"./index.1fe375b7.js";import"./scrollTo.f06f0aa0.js";import"./useBreakpoint.508a26d1.js";import"./responsiveObserve.0e84fd18.js";import"./useExpose.da4b76ce.js";import"./index.2fe134dc.js";import"./useFormItem.3078eec7.js";import"./iconUtil.5323a4d2.js";import"./_baseSet.62e0ca1c.js";import"./hasIn.55ea5e75.js";import"./FileOutlined.633a7a92.js";import"./user.d5977986.js";import"./transButton.928b71e3.js";import"./DeleteOutlined.123b484f.js";import"./commonEnum.da040d67.js";import"./index.b7943f07.js";import"./index.5cf0b4b1.js";import"./uniqBy.272154d9.js";import"./_baseIteratee.580b2020.js";import"./_baseProperty.74f89655.js";import"./findIndex.ca0f29b6.js";import"./toInteger.085db34b.js";import"./index.9cae10d5.js";import"./download.19f0ec6f.js";import"./index.ba68f563.js";import"./vendor.352e3120.js";import"./dayjs.77e2c65c.js";import"./index.173fb3cc.js";import"./Col.deca4875.js";import"./usePageContext.03f0ffc0.js";import"./index.aba8a851.js";import"./index.d9119902.js";import"./useSize.a97ab731.js";import"./ArrowLeftOutlined.70d092e9.js";import"./isNumeric.2bec345d.js";import"./UpOutlined.08898d4e.js";import"./index.44eb537e.js";import"./PlusOutlined.5bcc416d.js";const materialsBaseInfoSchema=[{field:"name",label:"\u540D\u79F0"},{field:"unit",label:"\u5355\u4F4D"},{field:"useScene",label:"\u7528\u9014"},{field:"remark",label:"\u5907\u6CE8"}],colorList=["green","cyan","#2db7f5","purple"],columns=[{title:"\u5E93\u623F",dataIndex:"warehouseName"},{title:"\u6570\u91CF",dataIndex:"quantity"},{title:"\u5B89\u5168\u5E93\u5B58",dataIndex:"safeQuantity"},{title:"\u64CD\u4F5C",dataIndex:"option"}];var _sfc_main=defineComponent({name:"skuDetails",components:{Description:_sfc_main$1,BasicTable:_sfc_main$2,PageWrapper:_sfc_main$3,[Divider.name]:Divider,Tag,Badge,Button,InputNumber,Modal,SettingOutlined,Form,FormItem,Input,Timeline,TimelineItem,Card,RightCircleFilled,LeftCircleFilled,Descriptions,DescriptionsItem,Empty,Spin},setup(){const{currentRoute}=useRouter(),params=computed(()=>unref(currentRoute).params),materialsBaseInfo=ref(),warehouseInventoryList=ref(),sku=ref(),skuName=ref(),recordList=ref(),visible=ref(!1),spinning=ref(!1),reverse=ref(!1),currentWarehouseInventory=ref(),formRef=ref(),skuSchema=[{label:"\u89C4\u683C\u503C",field:"skuSchema"},{label:"\u5355\u4F4D",field:"unit"},{label:"\u5E93\u5B58\u603B\u6570",field:"totalQuantity"},{label:"\u7269\u6599\u7F16\u7801",field:"code"},{label:"\u5BA1\u6279\u7C7B\u578B",field:"auditType"},{label:"\u5B89\u5168\u5E93\u5B58",field:"minQuantity"},{label:"\u91C7\u8D2D\u6307\u5BFC\u5355\u4EF7",field:"price"},{label:"\u9886\u7528\u5355\u4EF7",field:"claimPrice"},{label:"\u5907\u6CE8",field:"remark"}],warehouseMap=ref(new Map);onMounted(()=>{simpleList().then(e=>e.forEach(o=>warehouseMap.value.set(o.id,o.name))),getInfo()});const[registerRefundTable]=useTable({title:"\u5E93\u5B58\u660E\u7EC6",dataSource:warehouseInventoryList,columns,pagination:!1,showIndexColumn:!1,bordered:!0}),[registerTimeTable]=useTable({title:"\u5E93\u5B58\u53D8\u66F4\u8BB0\u5F55",columns:refundTimeTableSchema,pagination:!1,dataSource:refundTimeTableData,showIndexColumn:!1,scroll:{y:300}}),rules={quantity:[{required:!0,message:"\u5E93\u5B58\u6570\u4E0D\u80FD\u4E3A\u7A7A"}],safeQuantity:[{required:!0,message:"\u5B89\u5168\u5E93\u5B58\u6570\u4E0D\u80FD\u4E3A\u7A7A"}],remark:[{required:!0,message:"\u5907\u6CE8\u4E0D\u80FD\u4E3A\u7A7A"}]};function changeQuantity$1(e){currentWarehouseInventory.value=e,visible.value=!0}function commitChangeQuantity(){formRef.value.validate().then(()=>{spinning.value=!0;let e={id:currentWarehouseInventory.value.id,quantity:currentWarehouseInventory.value.quantity,safeQuantity:currentWarehouseInventory.value.safeQuantity,remark:currentWarehouseInventory.value.remark};changeQuantity(e).then(o=>{spinning.value=!1,visible.value=!1,getInfo()}).finally(()=>{spinning.value=!1})}).catch(e=>{console.log("error",e)})}function getInfo(){bySkuId(params.value.id).then(e=>{skuName.value=e.skuName,sku.value=e.sku,materialsBaseInfo.value=e.materialsBaseInfo,new Map(Object.entries(skuName.value)).forEach((o,l)=>{sku.value.skuSchema?sku.value.skuSchema+=" "+o:sku.value.skuSchema=o})}),listBySkuId(params.value.id).then(res=>{warehouseInventoryList.value=res,sku.value.totalQuantity=eval(warehouseInventoryList.value.map(e=>e.quantity).join("+"))}),listBySkuId$1(params.value.id).then(e=>{recordList.value=e})}return{params,warehouseInventoryList,sku,skuName,warehouseMap,materialsBaseInfo,registerRefundTable,registerTimeTable,materialsBaseInfoSchema,skuCommonColumns,colorList,skuSchema,columns,visible,currentWarehouseInventory,changeQuantity:changeQuantity$1,rules,formRef,commitChangeQuantity,getInfo,recordList,spinning,reverse}}}),index_vue_vue_type_style_index_0_scoped_true_lang=`.desc-wrap[data-v-2a2a24e4] {
  padding: 16px;
}`;const _withId=withScopeId();pushScopeId("data-v-2a2a24e4");const _hoisted_1=createTextVNode(" \u53D8\u66F4\u5E93\u5B58 "),_hoisted_2=createTextVNode("\u5E93\u5B58\u53D8\u66F4\u8BB0\u5F55"),_hoisted_3={style:{margin:"auto",padding:"30px"}},_hoisted_4={style:{padding:"30px",width:"100%"}};popScopeId();const _sfc_render=_withId((e,o,l,B,w,N)=>{const s=resolveComponent("Description"),n=resolveComponent("a-divider"),d=resolveComponent("SettingOutlined"),m=resolveComponent("Button"),c=resolveComponent("BasicTable"),p=resolveComponent("Empty"),f=resolveComponent("RightCircleFilled"),v=resolveComponent("LeftCircleFilled"),r=resolveComponent("DescriptionsItem"),b=resolveComponent("Descriptions"),_=resolveComponent("Card"),h=resolveComponent("TimelineItem"),I=resolveComponent("Timeline"),i=resolveComponent("Input"),a=resolveComponent("FormItem"),u=resolveComponent("InputNumber"),y=resolveComponent("Form"),g=resolveComponent("spin"),j=resolveComponent("Modal"),C=resolveComponent("PageWrapper");return openBlock(),createBlock("div",null,[createVNode(C,{title:"\u7269\u6599\u8BE6\u60C5\u9875",contentBackground:""},{default:_withId(()=>[createVNode(s,{size:"middle",title:"\u7269\u6599\u4FE1\u606F",bordered:!1,column:4,data:e.materialsBaseInfo,schema:e.materialsBaseInfoSchema},null,8,["data","schema"]),createVNode(n),createVNode(s,{size:"middle",layout:"vertical",title:"\u89C4\u683C\u4FE1\u606F",bordered:!0,column:9,data:e.sku,schema:e.skuSchema},null,8,["data","schema"]),createVNode(n),createVNode(c,{onRegister:e.registerRefundTable},{bodyCell:_withId(({column:t,record:k,index:S})=>[t.key==="option"?(openBlock(),createBlock(m,{key:0,danger:"",onClick:F=>e.changeQuantity(k)},{icon:_withId(()=>[createVNode(d)]),default:_withId(()=>[_hoisted_1]),_:2},1032,["onClick"])):createCommentVNode("",!0)]),_:1},8,["onRegister"]),createVNode(n,null,{default:_withId(()=>[_hoisted_2]),_:1}),!e.recordList||e.recordList.length<1?(openBlock(),createBlock(p,{key:0})):createCommentVNode("",!0),createVNode("div",_hoisted_3,[createVNode(I,{mode:"alternate",reverse:e.reverse},{default:_withId(()=>[(openBlock(!0),createBlock(Fragment,null,renderList(e.recordList,t=>(openBlock(),createBlock(h,{color:t.isInFlag?"green":"red",position:t.isInFlag?"right":"left"},createSlots({default:_withId(()=>[createVNode(_,{size:"small",title:t.createTime},{default:_withId(()=>[createVNode(b,{column:3,bordered:"",layout:"vertical"},{default:_withId(()=>[createVNode(r,{label:"\u6570\u91CF"},{default:_withId(()=>[createTextVNode(toDisplayString(t.quantity),1)]),_:2},1024),createVNode(r,{label:"\u4ED3\u5E93"},{default:_withId(()=>[createTextVNode(toDisplayString(e.warehouseMap.get(t.warehouseId)),1)]),_:2},1024),createVNode(r,{label:"\u64CD\u4F5C\u540D\u79F0"},{default:_withId(()=>[createTextVNode(toDisplayString(t.optionName),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["title"])]),_:2},[t.isInFlag?{name:"dot",fn:_withId(()=>[createVNode(v,{"two-tone-color":"#eb2f96",style:{"font-size":"24px"}})])}:{name:"dot",fn:_withId(()=>[createVNode(f,{"two-tone-color":"#52c41a",style:{"font-size":"24px"}})])}]),1032,["color","position"]))),256))]),_:1},8,["reverse"])]),createVNode(j,{visible:e.visible,"onUpdate:visible":o[5]||(o[5]=t=>e.visible=t),title:"\u53D8\u66F4\u5E93\u5B58",onOk:e.commitChangeQuantity,"confirm-loading":e.spinning},{default:_withId(()=>[createVNode(g,{spinning:e.spinning},{default:_withId(()=>[createVNode("div",_hoisted_4,[createVNode(y,{model:e.currentWarehouseInventory,"label-col":{span:4},"wrapper-col":{span:14},rules:e.rules,ref:"formRef"},{default:_withId(()=>[createVNode(a,{label:"\u5E93\u623F",name:"warehouseName"},{default:_withId(()=>[createVNode(i,{value:e.currentWarehouseInventory.warehouseName,"onUpdate:value":o[1]||(o[1]=t=>e.currentWarehouseInventory.warehouseName=t),disabled:""},null,8,["value"])]),_:1}),createVNode(a,{label:"\u5E93\u5B58\u6570",name:"quantity"},{default:_withId(()=>[createVNode(u,{value:e.currentWarehouseInventory.quantity,"onUpdate:value":o[2]||(o[2]=t=>e.currentWarehouseInventory.quantity=t),min:0,step:1},null,8,["value","step"])]),_:1}),createVNode(a,{label:"\u5B89\u5168\u5E93\u5B58",name:"safeQuantity"},{default:_withId(()=>[createVNode(u,{value:e.currentWarehouseInventory.safeQuantity,"onUpdate:value":o[3]||(o[3]=t=>e.currentWarehouseInventory.safeQuantity=t),min:0,step:1},null,8,["value","step"])]),_:1}),createVNode(a,{label:"\u4FEE\u6539\u8BF4\u660E",name:"remark"},{default:_withId(()=>[createVNode(i,{value:e.currentWarehouseInventory.remark,"onUpdate:value":o[4]||(o[4]=t=>e.currentWarehouseInventory.remark=t)},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["spinning"])]),_:1},8,["visible","onOk","confirm-loading"])]),_:1})])});_sfc_main.render=_sfc_render,_sfc_main.__scopeId="data-v-2a2a24e4";export default _sfc_main;

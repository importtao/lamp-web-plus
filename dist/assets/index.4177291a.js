import{_ as _sfc_main$1}from"./index.vue_vue&type=script&lang.fc4a12b0.js";import{_ as _sfc_main$2}from"./TableImg.9ff330fc.js";import"./BasicForm.2f71c419.js";import{u as useTable}from"./useTable.bbead477.js";import{_ as _sfc_main$3}from"./PageWrapper.d9e1596c.js";import{b as bySkuId}from"./sku.7ab11409.js";import{s as simpleList}from"./warehouse.1520d651.js";import{l as listBySkuId,c as changeQuantity}from"./warehouseInventory.4b8af495.js";import{l as listBySkuId$1}from"./warehouseInventoryRecord.5ddadd4b.js";import{refundTimeTableSchema,refundTimeTableData,skuCommonColumns}from"./data.4dc7c585.js";import{d as defineComponent,B as Button,cp as Modal,v as Input,cM as Empty,b7 as Spin,bH as useRouter,k as computed,D as unref,w as ref,x as onMounted,aW as pushScopeId,aX as popScopeId,r as resolveComponent,o as openBlock,n as createBlock,p as createVNode,N as createCommentVNode,M as Fragment,aE as renderList,aD as createSlots,L as createTextVNode,q as toDisplayString,aF as withScopeId}from"./index.05ea33df.js";import{D as Divider}from"./index.be446867.js";import{T as Tag}from"./index.cfb51f70.js";import{B as Badge}from"./index.bfcd36cd.js";import{I as InputNumber}from"./index.021ff727.js";import{S as SettingOutlined}from"./SettingOutlined.168a2578.js";import{F as Form,a as FormItem}from"./index.e5a1f932.js";import{T as Timeline,a as TimelineItem,R as RightCircleFilled,L as LeftCircleFilled}from"./RightCircleFilled.95d8ac6f.js";import{C as Card}from"./index.ff98d06f.js";import{D as Descriptions,a as DescriptionsItem}from"./index.b2ce6207.js";import"./get.f4e2a1c0.js";import"./useForm.f47588eb.js";import"./index.d265e78b.js";import"./index.cf387d6d.js";import"./uuid.2b29000c.js";import"./useWindowSizeFn.bedcc730.js";import"./useModal.024b9b70.js";import"./FullscreenOutlined.6ef047e2.js";import"./onMountedOrActivated.a12ac1c0.js";import"./useSortable.d85458f7.js";import"./RedoOutlined.d497a357.js";import"./useFullScreen.446380e8.js";import"./index.7c034053.js";import"./css.b1edd3c8.js";import"./canUseDom.0bf35682.js";import"./useState.20f1f9ca.js";import"./conductUtil.82525e99.js";import"./index.faeec8a2.js";import"./scrollTo.f3bf3653.js";import"./useBreakpoint.249417d5.js";import"./responsiveObserve.968aa5d0.js";import"./useExpose.f26dd80a.js";import"./index.8795eb20.js";import"./useFormItem.902ca43e.js";import"./iconUtil.d875d1ff.js";import"./_baseSet.e2b00d8d.js";import"./hasIn.3c39ff13.js";import"./FileOutlined.72b26251.js";import"./user.16e1967f.js";import"./transButton.9a1903a9.js";import"./DeleteOutlined.3986c5e6.js";import"./commonEnum.da040d67.js";import"./index.c3f5e4ba.js";import"./index.74eb6f9c.js";import"./uniqBy.6f8da1a0.js";import"./_baseIteratee.6051ea54.js";import"./_baseProperty.74f89655.js";import"./findIndex.0ad6ac98.js";import"./toInteger.e36ca646.js";import"./index.1393b71a.js";import"./download.5d8f05f1.js";import"./index.fe88e9db.js";import"./vendor.352e3120.js";import"./dayjs.26660a9f.js";import"./index.48bbff73.js";import"./Col.8bf95754.js";import"./usePageContext.918ba169.js";import"./index.dbdd549b.js";import"./index.03402249.js";import"./useSize.c28e111d.js";import"./ArrowLeftOutlined.97d250aa.js";import"./isNumeric.2bec345d.js";import"./UpOutlined.b05eb3d5.js";import"./index.e2b3f20e.js";import"./PlusOutlined.cfc7a86d.js";const materialsBaseInfoSchema=[{field:"name",label:"\u540D\u79F0"},{field:"unit",label:"\u5355\u4F4D"},{field:"useScene",label:"\u7528\u9014"},{field:"remark",label:"\u5907\u6CE8"}],colorList=["green","cyan","#2db7f5","purple"],columns=[{title:"\u5E93\u623F",dataIndex:"warehouseName"},{title:"\u6570\u91CF",dataIndex:"quantity"},{title:"\u5B89\u5168\u5E93\u5B58",dataIndex:"safeQuantity"},{title:"\u64CD\u4F5C",dataIndex:"option"}];var _sfc_main=defineComponent({name:"skuDetails",components:{Description:_sfc_main$1,BasicTable:_sfc_main$2,PageWrapper:_sfc_main$3,[Divider.name]:Divider,Tag,Badge,Button,InputNumber,Modal,SettingOutlined,Form,FormItem,Input,Timeline,TimelineItem,Card,RightCircleFilled,LeftCircleFilled,Descriptions,DescriptionsItem,Empty,Spin},setup(){const{currentRoute}=useRouter(),params=computed(()=>unref(currentRoute).params),materialsBaseInfo=ref(),warehouseInventoryList=ref(),sku=ref(),skuName=ref(),recordList=ref(),visible=ref(!1),spinning=ref(!1),reverse=ref(!1),currentWarehouseInventory=ref(),formRef=ref(),skuSchema=[{label:"\u89C4\u683C\u503C",field:"skuSchema"},{label:"\u5355\u4F4D",field:"unit"},{label:"\u5E93\u5B58\u603B\u6570",field:"totalQuantity"},{label:"\u7269\u6599\u7F16\u7801",field:"code"},{label:"\u5BA1\u6279\u7C7B\u578B",field:"auditType"},{label:"\u5B89\u5168\u5E93\u5B58",field:"minQuantity"},{label:"\u91C7\u8D2D\u6307\u5BFC\u5355\u4EF7",field:"price"},{label:"\u9886\u7528\u5355\u4EF7",field:"claimPrice"},{label:"\u5907\u6CE8",field:"remark"}],warehouseMap=ref(new Map);onMounted(()=>{simpleList().then(e=>e.forEach(o=>warehouseMap.value.set(o.id,o.name))),getInfo()});const[registerRefundTable]=useTable({title:"\u5E93\u5B58\u660E\u7EC6",dataSource:warehouseInventoryList,columns,pagination:!1,showIndexColumn:!1,bordered:!0}),[registerTimeTable]=useTable({title:"\u5E93\u5B58\u53D8\u66F4\u8BB0\u5F55",columns:refundTimeTableSchema,pagination:!1,dataSource:refundTimeTableData,showIndexColumn:!1,scroll:{y:300}}),rules={quantity:[{required:!0,message:"\u5E93\u5B58\u6570\u4E0D\u80FD\u4E3A\u7A7A"}],safeQuantity:[{required:!0,message:"\u5B89\u5168\u5E93\u5B58\u6570\u4E0D\u80FD\u4E3A\u7A7A"}],remark:[{required:!0,message:"\u5907\u6CE8\u4E0D\u80FD\u4E3A\u7A7A"}]};function changeQuantity$1(e){currentWarehouseInventory.value=e,visible.value=!0}function commitChangeQuantity(){formRef.value.validate().then(()=>{spinning.value=!0;let e={id:currentWarehouseInventory.value.id,quantity:currentWarehouseInventory.value.quantity,safeQuantity:currentWarehouseInventory.value.safeQuantity,remark:currentWarehouseInventory.value.remark};changeQuantity(e).then(o=>{spinning.value=!1,visible.value=!1,getInfo()}).finally(()=>{spinning.value=!1})}).catch(e=>{console.log("error",e)})}function getInfo(){bySkuId(params.value.id).then(e=>{skuName.value=e.skuName,sku.value=e.sku,materialsBaseInfo.value=e.materialsBaseInfo,new Map(Object.entries(skuName.value)).forEach((o,l)=>{sku.value.skuSchema?sku.value.skuSchema+=" "+o:sku.value.skuSchema=o})}),listBySkuId(params.value.id).then(res=>{warehouseInventoryList.value=res,sku.value.totalQuantity=eval(warehouseInventoryList.value.map(e=>e.quantity).join("+"))}),listBySkuId$1(params.value.id).then(e=>{recordList.value=e})}return{params,warehouseInventoryList,sku,skuName,warehouseMap,materialsBaseInfo,registerRefundTable,registerTimeTable,materialsBaseInfoSchema,skuCommonColumns,colorList,skuSchema,columns,visible,currentWarehouseInventory,changeQuantity:changeQuantity$1,rules,formRef,commitChangeQuantity,getInfo,recordList,spinning,reverse}}}),index_vue_vue_type_style_index_0_scoped_true_lang=`.desc-wrap[data-v-2a2a24e4] {
  padding: 16px;
}`;const _withId=withScopeId();pushScopeId("data-v-2a2a24e4");const _hoisted_1=createTextVNode(" \u53D8\u66F4\u5E93\u5B58 "),_hoisted_2=createTextVNode("\u5E93\u5B58\u53D8\u66F4\u8BB0\u5F55"),_hoisted_3={style:{margin:"auto",padding:"30px"}},_hoisted_4={style:{padding:"30px",width:"100%"}};popScopeId();const _sfc_render=_withId((e,o,l,B,w,N)=>{const s=resolveComponent("Description"),n=resolveComponent("a-divider"),d=resolveComponent("SettingOutlined"),m=resolveComponent("Button"),c=resolveComponent("BasicTable"),p=resolveComponent("Empty"),f=resolveComponent("RightCircleFilled"),v=resolveComponent("LeftCircleFilled"),r=resolveComponent("DescriptionsItem"),b=resolveComponent("Descriptions"),_=resolveComponent("Card"),h=resolveComponent("TimelineItem"),I=resolveComponent("Timeline"),i=resolveComponent("Input"),a=resolveComponent("FormItem"),u=resolveComponent("InputNumber"),y=resolveComponent("Form"),g=resolveComponent("spin"),j=resolveComponent("Modal"),C=resolveComponent("PageWrapper");return openBlock(),createBlock("div",null,[createVNode(C,{title:"\u7269\u6599\u8BE6\u60C5\u9875",contentBackground:""},{default:_withId(()=>[createVNode(s,{size:"middle",title:"\u7269\u6599\u4FE1\u606F",bordered:!1,column:4,data:e.materialsBaseInfo,schema:e.materialsBaseInfoSchema},null,8,["data","schema"]),createVNode(n),createVNode(s,{size:"middle",layout:"vertical",title:"\u89C4\u683C\u4FE1\u606F",bordered:!0,column:9,data:e.sku,schema:e.skuSchema},null,8,["data","schema"]),createVNode(n),createVNode(c,{onRegister:e.registerRefundTable},{bodyCell:_withId(({column:t,record:k,index:S})=>[t.key==="option"?(openBlock(),createBlock(m,{key:0,danger:"",onClick:F=>e.changeQuantity(k)},{icon:_withId(()=>[createVNode(d)]),default:_withId(()=>[_hoisted_1]),_:2},1032,["onClick"])):createCommentVNode("",!0)]),_:1},8,["onRegister"]),createVNode(n,null,{default:_withId(()=>[_hoisted_2]),_:1}),!e.recordList||e.recordList.length<1?(openBlock(),createBlock(p,{key:0})):createCommentVNode("",!0),createVNode("div",_hoisted_3,[createVNode(I,{mode:"alternate",reverse:e.reverse},{default:_withId(()=>[(openBlock(!0),createBlock(Fragment,null,renderList(e.recordList,t=>(openBlock(),createBlock(h,{color:t.isInFlag?"green":"red",position:t.isInFlag?"right":"left"},createSlots({default:_withId(()=>[createVNode(_,{size:"small",title:t.createTime},{default:_withId(()=>[createVNode(b,{column:3,bordered:"",layout:"vertical"},{default:_withId(()=>[createVNode(r,{label:"\u6570\u91CF"},{default:_withId(()=>[createTextVNode(toDisplayString(t.quantity),1)]),_:2},1024),createVNode(r,{label:"\u4ED3\u5E93"},{default:_withId(()=>[createTextVNode(toDisplayString(e.warehouseMap.get(t.warehouseId)),1)]),_:2},1024),createVNode(r,{label:"\u64CD\u4F5C\u540D\u79F0"},{default:_withId(()=>[createTextVNode(toDisplayString(t.optionName),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["title"])]),_:2},[t.isInFlag?{name:"dot",fn:_withId(()=>[createVNode(v,{"two-tone-color":"#eb2f96",style:{"font-size":"24px"}})])}:{name:"dot",fn:_withId(()=>[createVNode(f,{"two-tone-color":"#52c41a",style:{"font-size":"24px"}})])}]),1032,["color","position"]))),256))]),_:1},8,["reverse"])]),createVNode(j,{visible:e.visible,"onUpdate:visible":o[5]||(o[5]=t=>e.visible=t),title:"\u53D8\u66F4\u5E93\u5B58",onOk:e.commitChangeQuantity,"confirm-loading":e.spinning},{default:_withId(()=>[createVNode(g,{spinning:e.spinning},{default:_withId(()=>[createVNode("div",_hoisted_4,[createVNode(y,{model:e.currentWarehouseInventory,"label-col":{span:4},"wrapper-col":{span:14},rules:e.rules,ref:"formRef"},{default:_withId(()=>[createVNode(a,{label:"\u5E93\u623F",name:"warehouseName"},{default:_withId(()=>[createVNode(i,{value:e.currentWarehouseInventory.warehouseName,"onUpdate:value":o[1]||(o[1]=t=>e.currentWarehouseInventory.warehouseName=t),disabled:""},null,8,["value"])]),_:1}),createVNode(a,{label:"\u5E93\u5B58\u6570",name:"quantity"},{default:_withId(()=>[createVNode(u,{value:e.currentWarehouseInventory.quantity,"onUpdate:value":o[2]||(o[2]=t=>e.currentWarehouseInventory.quantity=t),min:0,step:1},null,8,["value","step"])]),_:1}),createVNode(a,{label:"\u5B89\u5168\u5E93\u5B58",name:"safeQuantity"},{default:_withId(()=>[createVNode(u,{value:e.currentWarehouseInventory.safeQuantity,"onUpdate:value":o[3]||(o[3]=t=>e.currentWarehouseInventory.safeQuantity=t),min:0,step:1},null,8,["value","step"])]),_:1}),createVNode(a,{label:"\u4FEE\u6539\u8BF4\u660E",name:"remark"},{default:_withId(()=>[createVNode(i,{value:e.currentWarehouseInventory.remark,"onUpdate:value":o[4]||(o[4]=t=>e.currentWarehouseInventory.remark=t)},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["spinning"])]),_:1},8,["visible","onOk","confirm-loading"])]),_:1})])});_sfc_main.render=_sfc_render,_sfc_main.__scopeId="data-v-2a2a24e4";export default _sfc_main;

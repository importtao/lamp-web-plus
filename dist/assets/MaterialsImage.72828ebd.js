import{u as P}from"./ali-oss.3141d013.js";import{d as U,cp as O,aC as B,w as c,ae as q,k as M,r as f,o as w,n as j,p as r,J as _,N as R}from"./index.b6dfbfcf.js";import{P as L}from"./PlusOutlined.84d8b58b.js";import{U as k}from"./index.672abebf.js";import"./vendor.352e3120.js";import"./upload.4cde268e.js";import"./uniqBy.c4f2e7ec.js";import"./_baseIteratee.2e9463e3.js";import"./get.4daef9c8.js";import"./hasIn.babd797c.js";import"./_baseProperty.74f89655.js";import"./findIndex.c7191173.js";import"./toInteger.e4331dbc.js";import"./index.1aad4d44.js";import"./FileOutlined.44378449.js";import"./DeleteOutlined.e9575d1c.js";function x(t){return new Promise((o,l)=>{const s=new FileReader;s.readAsDataURL(t),s.onload=()=>o(s.result),s.onerror=a=>l(a)})}var I=U({components:{PlusOutlined:L,Upload:k,Modal:O},name:"MaterialsImage",props:{max:B.number,materialsBaseInfo:Object},emits:["uploadSuccess"],setup(t,{emit:o}){const l=c(!1),s=c(""),a=c([]);q(t,(e,i)=>{if(t.materialsBaseInfo&&t.materialsBaseInfo.imgUrl){let n=0;a.value=t.materialsBaseInfo.imgUrl.trim().split(",").map(p=>(n--,{uid:n,name:n+".png",status:"done",url:p}))}});let u=M(()=>{if(a.value&&a.value.length>0)return a.value.filter(e=>e.url).map(e=>e.url).join(",")});return{previewVisible:l,previewImage:s,fileList:a,handleCancel:()=>{l.value=!1},handlePreview:async e=>{!e.url&&!e.preview&&(e.preview=await x(e.originFileObj)),s.value=e.url||e.preview,l.value=!0},handleChange:e=>{e.file.status==="uploading"},customRequest:e=>{const i=e.file;let n=i.name,p=n.lastIndexOf("."),C=n.substr(p),y=`${Date.parse(new Date)}`+parseInt(Math.random()*1e4)+C;P(y,i).then(m=>{let d=m.res.requestUrls[0];d.indexOf("uploadId=")>0&&(d=d.split("?uploadId=")[0]),a.value[a.value.length-1]={uid:"-"+a.value.length+1,name:a.value.length+1+".png",status:"done",url:d},o("uploadSuccess",u)}).catch(m=>{console.log(m),i.status="failed"})},beforeUpload:e=>{console.log(e);const i=e.type==="image/jpeg"||e.type==="image/png",n=e.size/1024/1024<10;return i&&n},result:u}}}),ae="";const $={class:"clearfix"},D={key:0},N=r("div",{class:"ant-upload-text"},"\u4E0A\u4F20",-1);function V(t,o,l,s,a,u){const v=f("plus-outlined"),g=f("Upload"),h=f("Modal");return w(),j("div",$,[r(g,{"file-list":t.fileList,"onUpdate:file-list":o[1]||(o[1]=b=>t.fileList=b),customRequest:t.customRequest,onChange:t.handleChange,"list-type":"picture-card",class:"sku-uploade",onPreview:t.handlePreview},{default:_(()=>[t.fileList.length<t.max?(w(),j("div",D,[r(v),N])):R("",!0)]),_:1},8,["file-list","customRequest","onChange","onPreview"]),r(h,{visible:t.previewVisible,footer:null,onCancel:t.handleCancel},{default:_(()=>[r("img",{alt:"example",style:{width:"100%"},src:t.previewImage},null,8,["src"])]),_:1},8,["visible","onCancel"])])}I.render=V;export default I;
